{% schema %}
{
  "name": "HSS Slideshow",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Abschnitt in voller Breite anzeigen",
      "default": false
    },
    {
      "type": "select",
      "id": "section_height",
      "label": "Seitenhöhe",
      "options": [
        { "value": "auto", "label": "An das erste Bild anpassen" },
        { "value": "small", "label": "Klein" },
        { "value": "medium", "label": "Mittel" },
        { "value": "large", "label": "Groß" },
        { "value": "full", "label": "Volle Bildschirmhöhe" },
        { "value": "three-quarters", "label": "Drei Viertel der Bildschirmhöhe" },
        { "value": "two-thirds", "label": "Zwei Drittel der Bildschirmhöhe" }
      ],
      "default": "auto"
    },
    {
      "type": "select",
      "id": "display_device",
      "label": "Auf welchem Gerät anzeigen?",
      "options": [
        { "value": "all", "label": "Alle Geräte" },
        { "value": "desktop", "label": "Nur Desktop" },
        { "value": "mobile", "label": "Nur Mobile" }
      ],
      "default": "all"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "slide_image",
          "label": "Bild auswählen"
        },
        {
          "type": "url",
          "id": "slide_link",
          "label": "Link für das Bild"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "HSS Slideshow",
      "category": "Bild"
    }
  ]
}
{% endschema %}

{% style %}
  .hss-slideshow {
    position: relative;
    overflow: hidden;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    {% if section.settings.full_width %} 
      max-width: 100vw;
    {% endif %}
  }

  .hss-slideshow .slides {
    display: flex;
    transition: transform 0.5s ease-in-out;
    align-items: center;
    height: 100%;
  }

  .hss-slideshow .slide {
    min-width: 100%;
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
  }

  .hss-slideshow img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Navigationspunkte */
  .hss-slideshow .dots {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .hss-slideshow .dot {
    width: 12px;
    height: 12px;
    margin: 0 5px;
    background-color: #ccc;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;
  }

  .hss-slideshow .dot.active {
    background-color: #333;
  }

  /* Pfeile für Desktop */
  @media (min-width: 768px) {
    .hss-slideshow .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s;
      z-index: 10;
    }

    .hss-slideshow .arrow:hover {
      background: rgba(255, 255, 255, 1);
    }

    .hss-slideshow .arrow-left {
      left: 10px;
    }

    .hss-slideshow .arrow-right {
      right: 10px;
    }

    .hss-slideshow .arrow svg {
      width: 20px;
      height: 20px;
      fill: #333;
    }
  }
{% endstyle %}

<div 
  class="hss-slideshow 
  {% if section.settings.display_device == 'desktop' %} only-desktop {% endif %}
  {% if section.settings.display_device == 'mobile' %} only-mobile {% endif %}"
>
  <!-- Pfeile (nur auf Desktop) -->
  <div class="arrow arrow-left">
    <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
  </div>
  <div class="arrow arrow-right">
    <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
  </div>

  <div class="slides">
    {% for block in section.blocks %}
      <div class="slide{% if forloop.first %} active{% endif %}">
        {% if block.settings.slide_link != blank %}
          <a href="{{ block.settings.slide_link }}">
            <img src="{{ block.settings.slide_image | img_url: 'master' }}" alt="Slideshow Image">
          </a>
        {% else %}
          <img src="{{ block.settings.slide_image | img_url: 'master' }}" alt="Slideshow Image">
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <!-- Navigationspunkte -->
  <div class="dots">
    {% for block in section.blocks %}
      <div class="dot{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}"></div>
    {% endfor %}
  </div>
</div>

{% javascript %}
  document.addEventListener("DOMContentLoaded", function() {
    let slides = document.querySelectorAll(".hss-slideshow .slide");
    let dots = document.querySelectorAll(".hss-slideshow .dot");
    let prevArrow = document.querySelector(".arrow-left");
    let nextArrow = document.querySelector(".arrow-right");
    let index = 0;

    function showSlide(n) {
      if (n < 0) { n = slides.length - 1; }
      if (n >= slides.length) { n = 0; }
      slides.forEach((slide, i) => {
        slide.style.transform = `translateX(-${n * 100}%)`;
        dots[i].classList.toggle("active", i === n);
      });
      index = n;
    }

    dots.forEach(dot => {
      dot.addEventListener("click", function() {
        let slideIndex = parseInt(this.getAttribute("data-index"));
        showSlide(slideIndex);
      });
    });

    prevArrow.addEventListener("click", function() {
      showSlide(index - 1);
    });

    nextArrow.addEventListener("click", function() {
      showSlide(index + 1);
    });
  });
{% endjavascript %}
