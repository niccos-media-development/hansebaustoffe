{% schema %}
{
  "name": "HSS Slideshow",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Abschnitt in voller Breite anzeigen",
      "default": false
    },
    {
      "type": "select",
      "id": "display_device",
      "label": "Auf welchem Gerät anzeigen?",
      "options": [
        { "value": "all", "label": "Alle Geräte" },
        { "value": "desktop", "label": "Nur Desktop" },
        { "value": "mobile", "label": "Nur Mobile" }
      ],
      "default": "all"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "slide_image",
          "label": "Bild auswählen"
        },
        {
          "type": "url",
          "id": "slide_link",
          "label": "Link für das Bild"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "HSS Slideshow",
      "category": "Bild"
    }
  ]
}
{% endschema %}

{% style %}
  .hss-slideshow { 
    position: relative; 
    overflow: hidden; 
    {% if section.settings.full_width %} width: 100vw; {% endif %}
  }
  
  .hss-slideshow .slides { 
    display: flex; 
    transition: transform 0.5s ease-in-out; 
  }
  
  .hss-slideshow .slide { 
    min-width: 100%; 
    flex-shrink: 0; 
    position: relative;
  }
  
  .hss-slideshow img { width: 100%; height: auto; display: block; }

  /* Standardmäßig verstecken */
  .only-desktop { display: none; }
  .only-mobile { display: none; }

  /* Desktop-Version sichtbar machen */
  @media (min-width: 768px) {
    .only-desktop { display: block; }
  }

  /* Mobile-Version sichtbar machen */
  @media (max-width: 767px) {
    .only-mobile { display: block; }
  }

  /* --- Navigation (Punkte unter der Slideshow) --- */
  .slideshow-pagination {
    display: flex;
    justify-content: center;
    margin-top: 15px;
  }
  
  .slideshow-pagination button {
    width: 12px;
    height: 12px;
    margin: 0 5px;
    border: none;
    background-color: #ccc;
    border-radius: 50%;
    cursor: pointer;
  }

  .slideshow-pagination button.active {
    background-color: #333;
  }
{% endstyle %}

<div 
  class="hss-slideshow 
  {% if section.settings.display_device == 'desktop' %} only-desktop {% endif %}
  {% if section.settings.display_device == 'mobile' %} only-mobile {% endif %}"
>
  <div class="slides">
    {% for block in section.blocks %}
      <div class="slide{% if forloop.first %} active{% endif %}">
        {% if block.settings.slide_link != blank %}
          <a href="{{ block.settings.slide_link }}">
            <img src="{{ block.settings.slide_image | img_url: 'master' }}" alt="Slideshow Image">
          </a>
        {% else %}
          <img src="{{ block.settings.slide_image | img_url: 'master' }}" alt="Slideshow Image">
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <!-- Navigation (Pagination) -->
  <div class="slideshow-pagination">
    {% for block in section.blocks %}
      <button data-slide="{{ forloop.index0 }}" {% if forloop.first %}class="active"{% endif %}></button>
    {% endfor %}
  </div>
</div>

{% javascript %}
  document.addEventListener("DOMContentLoaded", function() {
    let slides = document.querySelectorAll(".hss-slideshow .slide");
    let paginationButtons = document.querySelectorAll(".slideshow-pagination button");
    let currentIndex = 0;

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.style.transform = `translateX(-${index * 100}%)`;
      });

      paginationButtons.forEach((button, i) => {
        button.classList.toggle("active", i === index);
      });

      currentIndex = index;
    }

    paginationButtons.forEach(button => {
      button.addEventListener("click", function() {
        let index = parseInt(this.getAttribute("data-slide"));
        showSlide(index);
      });
    });
  });
{% endjavascript %}
